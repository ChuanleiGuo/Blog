<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"chuanleiguo.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"hide","padding":18,"offset":12,"onmobile":true},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="正因为未知，人与人之间的羁绊才愈发迷人">
<meta property="og:type" content="website">
<meta property="og:title" content="Chuan&#39;s Cabin">
<meta property="og:url" content="http://chuanleiguo.com/page/3/index.html">
<meta property="og:site_name" content="Chuan&#39;s Cabin">
<meta property="og:description" content="正因为未知，人与人之间的羁绊才愈发迷人">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Chuanlei Guo">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://chuanleiguo.com/page/3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Chuan's Cabin</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"] > svg a {
  fill: blue;
  stroke: blue;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container {
  overflow: auto hidden;
}

mjx-container + br {
  display: none;
}
</style></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Chuan's Cabin</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Code & Live with Love</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-programming-language">

    <a href="/categories/programming-language" rel="section"><i class="fa fa-rocket fa-fw"></i>编程语言</a>

  </li>
        <li class="menu-item menu-item-sourcecode">

    <a href="/categories/sourcecode" rel="section"><i class="fa fa-code fa-fw"></i>源码分析</a>

  </li>
        <li class="menu-item menu-item-computer-science">

    <a href="/categories/computer-science" rel="section"><i class="fa fa-cogs fa-fw"></i>计算机科学</a>

  </li>
        <li class="menu-item menu-item-mooc">

    <a href="/categories/mooc" rel="section"><i class="fa fa-graduation-cap fa-fw"></i>MOOC</a>

  </li>
        <li class="menu-item menu-item-booknotes">

    <a href="/categories/booknotes" rel="section"><i class="fa fa-book fa-fw"></i>读书笔记</a>

  </li>
        <li class="menu-item menu-item-diary">

    <a href="/categories/diary" rel="section"><i class="fa fa-keyboard fa-fw"></i>日志</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://chuanleiguo.com/2016/12/22/Linear-Regression/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Chuanlei Guo">
      <meta itemprop="description" content="正因为未知，人与人之间的羁绊才愈发迷人">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chuan's Cabin">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/12/22/Linear-Regression/" class="post-title-link" itemprop="url">【机器学习课程笔记】| 线性回归（Linear Regression）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2016-12-22 20:37:23" itemprop="dateCreated datePublished" datetime="2016-12-22T20:37:23+08:00">2016-12-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-03-03 11:30:13" itemprop="dateModified" datetime="2021-03-03T11:30:13+08:00">2021-03-03</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mooc/" itemprop="url" rel="index"><span itemprop="name">MOOC</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2016/12/22/Linear-Regression/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/12/22/Linear-Regression/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="绪论"><a href="#绪论" class="headerlink" title="绪论"></a>绪论</h1><p>我从这周开始在<a href="https://www.coursera.org/" target="_blank" rel="noopener">Course</a>上开始了对Machine Learning的学习，注册了吴恩达教授的<a href="https://www.coursera.org/learn/machine-learning/home" target="_blank" rel="noopener">机器学习</a>课程。所以我准备在自己的博客上整理课程的学习笔记，并记录自己的思考。</p>
<h2 id="什么是机器学习"><a href="#什么是机器学习" class="headerlink" title="什么是机器学习"></a>什么是机器学习</h2><p>机器学习：致力于研究如何通过计算的手段，利用经验来来改善系统自身的性能。我们把经验数据提供给学习算法，它就能根据这些数据产生模型；在面对新的情况时，模型就可以给我们提供相应的判断。如果说计算机科学是研究关于“算法”的学问，那么我们可以说机器学习是研究“学习算法”的学问。</p>
<p>机器学习也有更学术化的定义：</p>
<blockquote>
<p>假设用 P 来评估计算机程序在某任务上的性能，若一个程序通过利用经验 E 在 T 中任务上获得了性能呢改善，则我们就说关于 T 和 P，该程序对 E 进行了学习。   — Mitchell</p>
</blockquote>
<p>注意，机器学习的目标是使学习得到的模型能很好得适用于<strong>新样本</strong>。</p>
<h3 id="监督学习（Supervised-Learning）和非监督学习-Unsupervised-Learning"><a href="#监督学习（Supervised-Learning）和非监督学习-Unsupervised-Learning" class="headerlink" title="监督学习（Supervised Learning）和非监督学习(Unsupervised Learning)"></a>监督学习（Supervised Learning）和非监督学习(Unsupervised Learning)</h3><p>根据训练数据是否有标记信息，机器学习的任务和分为两大类：监督学习（Supervised Learning）和非监督学习（Unsupervised Learning）。对于监督学习任务，我们明确得知道数据具有某些特点或者事先已经知道了样本将会属于什么类别，例如将西瓜分为“好瓜”与“坏瓜”，根据历史房价来预测未来房价；而对非监督学习任务，我们事先也不知道算法所产生的结果所具有的特点，例如对西瓜做聚类（Clusting）后，可能将西瓜分为“浅色瓜”和“深色瓜”等我们事先不知道的概念。监督学习有两种典型的任务：分类（Classification）和回归（Regression）。如果我们希望预测的是离散值，如“好瓜”或“坏瓜”、“盈利”或“亏损”等，那么该任务为分类任务；如果我们希望预测的是连续值，如在未来某个时间节点的房价、股票价格，那么该任务为回归任务。</p>
<h1 id="线性回归（Linear-Regression）"><a href="#线性回归（Linear-Regression）" class="headerlink" title="线性回归（Linear Regression）"></a>线性回归（Linear Regression）</h1><p>线性模型是一种简单、易于建模的模型，我们可以根据已有数据学习得到线性函数中的参数。得到参数的过程叫做线性回归(Linear Regression)。<br>现在假设我们得到了房产面积和房价的数据，而希望预测某个面积房产的房价。首先，我们需要根据已有的数据估计出模型的函数表达式。为了直观显示房产面积和房价的关系，我们可以将房价的数据绘制出来，观察数据间的关系。</p>
<p><img src="/images/2016-12-25/points.png" alt="points"><br>根据住房面积和房价之间的散点图，我们可以认为面积和房价成线性关系，即可以假设房价 y 和面积 x 的函数关系为：</p>
<p>$$ h_{\theta}(x) = \theta_0 + \theta_1x $$</p>
<p>其中 $x$ 模型的属性。<br>之后，我们就需要通过“学习”已有的数据，得到函数用得系数值。</p>
<h2 id="成本函数（Cost-Function）"><a href="#成本函数（Cost-Function）" class="headerlink" title="成本函数（Cost Function）"></a>成本函数（Cost Function）</h2><p>在实现“回归”之前，我们将 Cost Function 定义为：</p>
<p>$$ J( \theta_0 , \theta_1 ) = \frac{1}{2m}\sum_{i=1}^{m}(h_{\theta}(x_i) - y_i)^2 $$</p>
<p>这个函数定义了使用现有模型得出的 m 个预测值和实际值的均方误差（square loss）的平均值，而前面的 $\frac{1}{2}$ 则是为了之后的处理方便而添加的。</p>
<p>所以，我们的“回归”过程的目的，就是通过对“学习数据”的学习，得到一个模型，是得 Cost Function 的值最小。</p>
<h2 id="梯度下降（Gradient-Descent）"><a href="#梯度下降（Gradient-Descent）" class="headerlink" title="梯度下降（Gradient Descent）"></a>梯度下降（Gradient Descent）</h2><p>在机器学习中，常用梯度下降（Gradient Descent）的方法，通过不断迭代，学习得到使得 $J(\theta_0, \theta_1)$ 最小的 $\theta_0$ 和 $\theta_1$ 的值。</p>
<p>梯度下降方法的基本过程可以用伪代码来表示：</p>
<p>repeat until converage {</p>
<p>$$\theta_0 = \theta_0 - \alpha\sum_{i=1}^{m}(h_\theta(x_i) - y_i)$$</p>
<p>$$\theta_1 = \theta_1 - \alpha\sum_{i=1}^{m}((h_\theta(x_i) - y_i)x_i)$$</p>
<p>}</p>
<p>要注意的是，$\theta_0$和$\theta_1$必须要被同步更新，否则会导致算法出错。</p>
<p>我们可以研究下，为什么通过梯度下降的方式可以最终迭代到最优点。以一个简单的二次函数为例：</p>
<p><img src="/images/2016-12-25/group.png" alt="group"></p>
<p>假设我们从 A 点开始使用梯度下降的方法迭代，该函数在 A 点的导数小于零，所以在梯度下降的过程中，$\theta = \theta - \alpha\frac{\mathrm d}{\mathrm d x}J(x)$ 会使得 $\theta$ 不断向右逼近，从而接近最低点。在 B 点同理可得，在梯度下降的过程中，$\theta$ 会不断向左逼近，靠近最低点。</p>
<p>在梯度下降的迭代过程中，我们通过选择不同的 $\alpha$ 值来控制 $\theta$ 变化的幅度或大小。当 $\theta$ 越小时，算法迭代的过程就以越小的步伐(更高的精度)来逼近最优点。所以，$\alpha$ 被称为 Learning Rate。</p>
<p>当 $\alpha$ 足够小的时候，梯度下降算法一定会最终抵达最优点。而且在迭代过程中不需要改变 $\alpha$ 的值，算法最终一定会收敛。这在数学上已经得到了证明。</p>
<p>但是要注意，梯度下降算法最终找到的是<strong>局部</strong>最优点，而不一定是全局最优点。</p>
<h2 id="多元线性回归（Linear-Regression-with-Multiple-Variables）"><a href="#多元线性回归（Linear-Regression-with-Multiple-Variables）" class="headerlink" title="多元线性回归（Linear Regression with Multiple Variables）"></a>多元线性回归（Linear Regression with Multiple Variables）</h2><p>在单变量线性回归问题中，我们假设模型只有一个属性。而在多元线性回归问题中，我们认为模型有多个属性。例如，在之前提到的预测房价的问题中，房价可能不仅仅有房产的面积所决定，还会被房产的年代、地段等因素影响。</p>
<p>在队员线性回归问题中，我们用变量 n 来代表模型属性的个数，$x^{(i)}$ 是一个行向量表示第 i 个训练样本的属性集，$x_j^{(i)}$ 表示第 i 个训练样本的第 j 个属性的值。</p>
<p>我们令 $x_0=1$ ，那么我们的模型和定义为：</p>
<p>$$h_{\theta}(x) = \theta_0 + {\theta_1}x_1 + {\theta_2}x_2 + \cdots + {\theta_n}x_n$$</p>
<p>即：</p>
<p>$$ h_{\theta}(x) = {\theta}^{T}x $$</p>
<p>其中：</p>
<p>$ {\theta^{T}} = [\theta_0, \theta_1, \cdots, \theta_n], x^{T} = [1, x_1, x_2, \cdots, x_n] $</p>
<p>现在我们在多元线性回归问题中使用梯度下降方法学习得到模型参数的过程可以写为：</p>
<p>repeat until converage {</p>
<p>$$ \theta_{j} = \theta_{j} - \alpha\frac{1}{m}\sum_{i=1}^{m}(h_{\theta}(x^{(i)} - y^{(i)})x_j^{(i)}) $$</p>
<p>$$j = 1 \cdots n$$</p>
<p>}</p>
<p>注意，各参数必须<strong>同步</strong>更新。</p>
<h2 id="加速收敛方法"><a href="#加速收敛方法" class="headerlink" title="加速收敛方法"></a>加速收敛方法</h2><p>在课程中，吴恩达教授还介绍了几种可以加速梯度下降过程的方法，分别是：Feature Scaling, Mean Normalization 和 选择 Learning Rate 的方法。</p>
<h3 id="Feature-Scaling"><a href="#Feature-Scaling" class="headerlink" title="Feature Scaling"></a>Feature Scaling</h3><p>Feature Scaling 的主要原理是各个模型在数值上处于同一个“范围”，如都在$[0, 1]$这个范围。在预测房价的例子中，我们假设房产有属性：房产面积 $x_1 \in [0, 2000]$, 卧室数目 $x_2 \in [0, 5]$ 。这两个属性不在同一个数量级，那么在梯度下降的迭代过程中，可能出现算法收敛过慢，收敛路径复杂等问题。</p>
<p>为了解决这个问题，我们使用 Feature Scaling 方法，使得:</p>
<p>$$x_1 = \frac{x_1}{2000}$$ $$x_2 = \frac{x_2}{5}$$</p>
<p>或者我们使用 Mean Normalization 方法。令 $\mu_i = mean(x_i)$ , 有：</p>
<p>$$x_i = \frac{x_i - \mu_i}{max(x_i) - min(x_i)}$$</p>
<p>通过这两种方法，我们可以将所有属性在数值上属于同一范围，从而可以显著梯度下降的迭代速度。</p>
<h3 id="选择合理的-Learning-Rate"><a href="#选择合理的-Learning-Rate" class="headerlink" title="选择合理的 Learning Rate"></a>选择合理的 Learning Rate</h3><p>另外一种保证算法收敛的方式就是要选择一个大小合适的 Learning Rate。因为如果 $\alpha$ 过小，那么算法会收敛过慢；如果 $aplha$ 过大，可能导致算法无法保证在每次迭代使得参数减小。</p>
<p>我们可以将使用不同 Learning Rate 的迭代过程用可视化的方式表示出来，通过这种更形象的方式选择合适的 Learning Rate。</p>
<h3 id="多项式回归（Polynomial-Regression）"><a href="#多项式回归（Polynomial-Regression）" class="headerlink" title="多项式回归（Polynomial Regression）"></a>多项式回归（Polynomial Regression）</h3><p>我们可以将多个属性组合成一个新的属性用于对模型参数的预测，例如将房产的地基长度x1和地基宽度x2组合为房产面积x3。</p>
<p>当我们的训练数据不能很好得用线性函数描述时，我们可以考虑使用二次或三次函数。</p>
<h2 id="Normal-Equation"><a href="#Normal-Equation" class="headerlink" title="Normal Equation"></a>Normal Equation</h2><p>在线性回归的问题中，我们的目的是通过学习训练数据，得到新的参数 $\theta$ 使得 $J(\theta)$ 最小。体用微积分的知识，我们可以对 $J(\theta)$ 中的 $\theta_0$ , $\theta_1$ 等分别求偏导数，并同时令偏导数等于0，即可算出使得 $J(\theta)$ 最小的参数值。</p>
<p>结论： 当 $\theta = (X^{T}X)^{-1}X^{T}y$时，$J(\theta)$ 最小。</p>
<p>我们对比梯度下降和 Normal Equation 方法：</p>
<p>| 梯度下降 | Normal Equation |<br>| 需要选择合适的 Learning Rate | 不需要选择Learning Rate |<br>| 需要多次迭代 | 不需要迭代 |<br>| 时间复杂度 O(kn^2) | 时间复杂度 O(n^3) |<br>| 在样本数量很大时，很有效 | 样本数量很大时，效率很低 |</p>
<h1 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h1><ol>
<li><a href="https://www.amazon.cn/%E5%9B%BE%E4%B9%A6/dp/B01ARKEV1G" target="_blank" rel="noopener">机器学习</a> 周志华</li>
<li><a href="https://www.coursera.org/learn/machine-learning/home" target="_blank" rel="noopener">Machine Learning</a> Stanford</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://chuanleiguo.com/2016/09/28/Guard-%E7%9A%84%E7%94%A8%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Chuanlei Guo">
      <meta itemprop="description" content="正因为未知，人与人之间的羁绊才愈发迷人">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chuan's Cabin">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/09/28/Guard-%E7%9A%84%E7%94%A8%E6%B3%95/" class="post-title-link" itemprop="url">Guard 的用法</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2016-09-28 15:14:46" itemprop="dateCreated datePublished" datetime="2016-09-28T15:14:46+08:00">2016-09-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-03-03 11:30:13" itemprop="dateModified" datetime="2021-03-03T11:30:13+08:00">2021-03-03</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/programming-language/" itemprop="url" rel="index"><span itemprop="name">编程语言</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2016/09/28/Guard-%E7%9A%84%E7%94%A8%E6%B3%95/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/09/28/Guard-的用法/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><code>guard</code> 关键字从 Swift 2.0 开始被引入，但是因为这一个关键字同时可以发挥四个作用，所以我们需要全面地理解它。</p>
<p>第一个作用显而易见：<code>guard</code> 用来实现提前退出。这意味着一个函数在一些前提条件不满足的情况下可以直接返回。例如，我们写一个简单的函数，实现为一个歌手颁奖：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">giveAward</span><span class="params">(to name: String)</span></span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> name == <span class="string">"ChuanleiGuo"</span> <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"No way!"</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Congratulations, \(name)!"</span>)</span><br><span class="line">&#125;</span><br><span class="line">giveAward(to: <span class="string">"ChuanleiGuo"</span>)</span><br></pre></td></tr></table></figure>

<p>在 <code>giveAward(to:)</code> 方法中使用 <code>guard</code> 关键字使得只有 ChuanleiGuo 同学才能获奖😋。虽然这个函数没什么实际作用，但是方法能够继续运行的前提条件非常清晰：只有在获奖人是 ChunaleiGuo 同学的时候，方法才能继续进行。</p>
<p>这个例子看起来和直接使用 <code>if</code> 语句做判断几乎是一样的，但是使用 <code>guard</code> 有一个巨大的优势：使你的意图更加清晰，不仅仅对于人，对于编译器也是一样。这是一个提前退出语句，意味着当条件不满足的时候，方法应该退出。使用 <code>guard</code> 说明：这个条件并不是方法的一部分，它存在的意义就是要保证后面的代码<strong>安全</strong>地执行。这对编译器也更加清晰，如果我们删除了上面的 <code>return</code> 语句，代码就无法编译了。因为编译器发现这是一个提前退出语句，而我们却没有退出。</p>
<p>第二个作用可以说是意外的收获：使用 <code>guard</code> 可以减少我们代码的缩进量。一些开发者朋友仍未永远都不应该使用提前退出，相反，每一个函数仅仅应该在一个地方返回。这就要求在函数的主要部分增加额外的缩进量：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">giveAward</span><span class="params">(to name: String)</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> message: <span class="type">String</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> name == <span class="string">"ChuanleiGuo"</span> &#123;</span><br><span class="line">        message = <span class="string">"Congratulations, \(name)!"</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        message = <span class="string">"No way!"</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> message</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">giveAward(to: <span class="string">"ChuanleiGuo"</span>)</span><br></pre></td></tr></table></figure>

<p>使用 <code>guard</code> 后，我们立刻处理的函数运行的前提条件，并且消除了额外的缩进量，代码也变得更经凑了呢！</p>
<p>第三个作用是使得代码的成功路径更加清晰。成功路径，代表着在没有错误和异常发生的情况下，你的代码的运行路径。有了 <code>guard</code> 之后，所有的错误都被立刻消除了。现在代码里仅仅剩下了成功路径。</p>
<p>以上的三个作用都比较简单，但是 <code>guard</code> 的还有很重的的一个作用，这也是它和 <code>if</code> 语句的重要区别：在我们使用 <code>guard</code> 判断并解包一个可选值之后，可选值会继续存在于作用域中。为了演示，我们重写 <code>giveAward(to:)</code>:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">giveAward</span><span class="params">(to name: String?)</span></span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> winner = name <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"No one won the award"</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Congratulations, \(winner)!"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果使用 <code>if - let</code> 语句的话，<code>winner</code> 仅仅会存在于被属于 <code>if - let</code> 大括号包围的作用域中。然而，<code>guard</code> 使得解包后的可选值继续存在于函数的作用域中，所以我们可以使用 <code>print()</code> 直接输出它。这段代码可以这样理解：“试着将解包后的可选值复制给winner，来让我们继续使用它，但是如果可选值为空，那么打印信息并退出”。</p>
<p>最后一个作用，并不新鲜。相反，它仅仅是对于已知知识点的新运用：如果条件不满足的话，<code>guard</code>可以让我们跳出任何作用域，不仅仅是函数的方法。也就是说，你可以跳出 <code>switch</code>语句，也可以跳出 <code>while</code> 和 <code>for</code> 循环。</p>
<p>下面的例子，用两种方法实现从1遍历到100，输出所有可以被8整除的数：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">1</span>...<span class="number">1000</span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> i % <span class="number">8</span> == <span class="number">0</span> <span class="keyword">else</span> &#123; <span class="keyword">continue</span> &#125;</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">1</span>...<span class="number">1000</span> <span class="keyword">where</span> i % <span class="number">8</span> == <span class="number">0</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们可以在不同的情况下选择使用不同的方法。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://chuanleiguo.com/2016/09/04/%E5%86%99%E5%9C%A8%E7%A0%94%E7%A9%B6%E7%94%9F%E5%85%A5%E5%AD%A6%E7%9A%84%E5%89%8D%E5%A4%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Chuanlei Guo">
      <meta itemprop="description" content="正因为未知，人与人之间的羁绊才愈发迷人">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chuan's Cabin">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/09/04/%E5%86%99%E5%9C%A8%E7%A0%94%E7%A9%B6%E7%94%9F%E5%85%A5%E5%AD%A6%E7%9A%84%E5%89%8D%E5%A4%9C/" class="post-title-link" itemprop="url">写在研究生入学的前夜</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2016-09-04 20:37:23" itemprop="dateCreated datePublished" datetime="2016-09-04T20:37:23+08:00">2016-09-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-03-03 11:30:13" itemprop="dateModified" datetime="2021-03-03T11:30:13+08:00">2021-03-03</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/diary/" itemprop="url" rel="index"><span itemprop="name">日志</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2016/09/04/%E5%86%99%E5%9C%A8%E7%A0%94%E7%A9%B6%E7%94%9F%E5%85%A5%E5%AD%A6%E7%9A%84%E5%89%8D%E5%A4%9C/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/09/04/写在研究生入学的前夜/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>开学后我就是研究生了，进入了新的求学的阶段。</p>
<p>为什么要读研呢？因为我明白自己的实力、资历还不能够胜任好公司的岗位，所以决定继续在学校学习。这也就意味着，接下来的三年我的长远计划就是要持续学习、科研和实习，最终顺利拿到心仪的Offer。</p>
<p>我从大一进入计算机学院开始学习编程，从C语言起，依次学习了C++、Java、Python、Objective-C、Swift，JavaScript，研究了Web开发的各种框架，可是最终都仅仅停留在了明白如何使用，至于它们的实现原理，核心思想则一概不知。在本科四年的时间里，虽然编写了Web后台、前端、iOS App等大大小小的所谓“项目”，但是现在回过头来看看，翻翻躺在我硬盘里的项目代码，真是觉得拿不出手。滥用单例、没有设计模式、命名不规范、逻辑混乱、模块无法复用、完全不做测试等等问题，让我意识到自己的代码力还远远不够。</p>
<p>在本科期间，我做过的最正确的决定就是跟着Bia哥去参加ACM训练和竞赛。在学校培训期间，我认识了来自各个学院的编程好手：徐翔、赞赞、++7、dyx，最重要的是在有幸跟随校队参加的几场ACM比赛中还抱大腿拿了奖，嘿嘿。。。在封闭训练和比赛的日子里，我观察大神们的学习技巧、编码技巧，感受他们对技术的热情。我从他们对技术的理解里学到了很多东西，打开了自己的眼界，也要求自己写出高质量的代码，受益匪浅。我的队友们在毕业的时候也顺利进入了自己心仪的公司，做着自己喜欢的工作，前路一片光明。这也让我相信，美好的人总是会被世界善待的。</p>
<p>被录取后，我也开始了自己的⎡研究生自我培养计划⎦。鉴于20年来的计划失败经历，这次在自我培养计划中，我没有定太高或太宏伟的目标，只是从一些小目标开始，一步步进步。那么研一上学期我的计划只有两项：</p>
<ol>
<li>坚持学英语，每天学习⎡懂你英语⎦课程的两个Lesson，听写一篇英语文章。</li>
<li>坚持每天课外编程至少3小时。</li>
</ol>
<p>在英语学习上，我的目标是要实现一次美国自由行。我从7月份开始购买了英语流利说的⎡懂你英语⎦课程，用来改善自己哑巴英语的问题。在7、8两个月我连续打卡，从Level3升到了Level5。所以在研究生入学后继续坚持英语学习，不断做自我小测验，最终在11月份参加雅思考试来检验自己的水平。</p>
<p>在编程学习上，必须完成的任务是每天至少完成一道LeetCode题目来练习算法和数据结构，到目前为止已经完成了249道题目；每天必须给自己项目提交代码，现在手头正在进行的是使用Swift仿写⎡网易新闻⎦客户端，完成后会放到Github接受群众检验。项目完成后，我也不能仅仅停留于实现功能，而要继续不断重构，提高代码质量；不能仅仅使用开源库，也会分析和阅读优秀项目的源代码，目前我暂时完成了一篇代码阅读心得：(SwiftyJSON源代码学习笔记)[] 。以后也会不断更新。</p>
<p>希望自己的研究生生活不要再像本科那样蹉跎，从实现一个个小目标开始，踏实前行。</p>
<p>加油吧。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://chuanleiguo.com/2016/08/09/%E5%AF%8C%E7%88%B8%E7%88%B8%E7%A9%B7%E7%88%B8%E7%88%B8%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Chuanlei Guo">
      <meta itemprop="description" content="正因为未知，人与人之间的羁绊才愈发迷人">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chuan's Cabin">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/08/09/%E5%AF%8C%E7%88%B8%E7%88%B8%E7%A9%B7%E7%88%B8%E7%88%B8%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">《富爸爸 穷爸爸》读书笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2016-08-09 12:55:23" itemprop="dateCreated datePublished" datetime="2016-08-09T12:55:23+08:00">2016-08-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-03-03 11:30:13" itemprop="dateModified" datetime="2021-03-03T11:30:13+08:00">2021-03-03</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/booknotes/" itemprop="url" rel="index"><span itemprop="name">读书笔记</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2016/08/09/%E5%AF%8C%E7%88%B8%E7%88%B8%E7%A9%B7%E7%88%B8%E7%88%B8%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/08/09/富爸爸穷爸爸读书笔记/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>《富爸爸 穷爸爸》是我读的第一本财务类，或者说财商类的书。</p>
<p>作为一个学生党，对未来有无数不切实际的，宏大的设想，实现财务自由也是一个刚刚有了微薄的收入，深感钱不够花的人的美好的愿望。我希望了解一些财务类的知识，但又担心太晦涩、太专业的著作会让我这个“财盲”望而却步，所以我在豆瓣检索、比较后选择了《富爸爸 穷爸爸》这本书。</p>
<p><img src="/images/2016-8-9/image.jpg" alt="image"></p>
<p>这是一本优秀的财务启蒙书。之前，我对财务的理解就是省钱 -&gt; 努力工作 -&gt; 存钱。这本书让我明白了其实投资和理财并不是富人的专属活动，普通人也可以通过学习和努力，培养财商，逐步踏上财务自由之路。理财和投资是一个生活态度，财商可以让人获利。</p>
<p>作者有两个爸爸，一个富，一个穷。一个爸爸受过良好的教育，拥有博士学位，但是一生都在财务问题中挣扎；另一个爸爸低学历，但却是当地最富有的人之一。两个爸爸都曾给予他人生和理财的建议，比如：一个爸爸说“贪财乃万恶之源”，另一个爸爸说“贫穷才是万恶之源”。作者通过对比和独立的思考最终选择了自己的道路，并实现了财务自由。作者希望每个人都接受财商教育，获得驾驭钱的力量，并在本书中教授了六门课程。</p>
<h2 id="富人不为钱而工作"><a href="#富人不为钱而工作" class="headerlink" title="富人不为钱而工作"></a>富人不为钱而工作</h2><p>生活是最好的老师，它永远在推着人们前进，也在不断给予人们机会。一些人在被生活推着转的同时，抓住了生活赐予的机会，学会了新的东西；而另一些人则与生活抗争，对机会视而不见，最终对生活屈服。</p>
<h3 id="改变自己比改变比人更容易"><a href="#改变自己比改变比人更容易" class="headerlink" title="改变自己比改变比人更容易"></a>改变自己比改变比人更容易</h3><p>我们在被生活推着前进的同时，抱怨、愤怒没有任何作用，要不断学习，让自己进步，因为改变自己永远比改变别人更容易。</p>
<blockquote>
<p>“如果你认为这是我的问题，你就会想要改变我；如果你认为问题在你那儿，你就会改变自己，学习一些东西让自己变得更聪明。大多数人认为世界上除了自己外，其他人都需要改变。其实，改变自己比改变别人更容易。”</p>
</blockquote>
<h3 id="穷人和中产阶级为钱工作"><a href="#穷人和中产阶级为钱工作" class="headerlink" title="穷人和中产阶级为钱工作"></a>穷人和中产阶级为钱工作</h3><p>学习需要精力、激情和愿望，激情是愤怒和热爱的集合体。而关于钱，穷人没有激情，只有恐惧，他们相信工作就是为了钱。它们的生活被恐惧和贪婪所控制。</p>
<p>大多数人的学习在大学毕业后也就到头了，而我们却应该用一生来研究钱和钱的规律。缺乏财商教育才是解决生活问题的关键。</p>
<p>我们要学习在深思后作出思考，而不是用感情。</p>
<p>永远别忘记，会有两种感情——恐惧和欲望，使你落入一生中最大的陷讲。</p>
<p>富人不为钱而工作。它们忘记自己的工资，不求回报地工作，并最终看见别人看不见的的东西。它们会在一生中不断地发现机会，从而避开生活中最大的陷阱。</p>
<h2 id="为什么要教授财务知识"><a href="#为什么要教授财务知识" class="headerlink" title="为什么要教授财务知识"></a>为什么要教授财务知识</h2><p>只有知识才能解决问题并创造财富，那些不是靠财务知识挣来的钱也不会长久。</p>
<p>从长远来看，重要的不是你挣了多少钱，而是你能留下多少钱，以及能留住多久。</p>
<p>所以，如果你想发财，就要学习财务知识。</p>
<p>要分辨资产和负债的区别。</p>
<blockquote>
<p>富人获得资产，而穷人和中产阶级获得负债，只不过他们以为那些负债就是资产。<br>资产，就是能把钱放到你口袋里的东西。</p>
</blockquote>
<p>看不懂关于财务的文字或者读不懂数字的含义，是产生财务问题的根本原因。</p>
<p>聪明的人要雇佣比他更聪明的人。</p>
<p>资产项产生的收入足以弥补支出，还可以用剩余的收入对资产项进行再投资。资产项不断增长，相应的收入也会越来越多。其结果就是：富人越来越富！</p>
<p>财富是将资产项产生的现金与支出项流出的现金进行比较而定的。</p>
<blockquote>
<p>富人买入资产，穷人只有支出，中产阶级购买自以为是资产的负债。</p>
</blockquote>
<h2 id="关注自己的事业"><a href="#关注自己的事业" class="headerlink" title="关注自己的事业"></a>关注自己的事业</h2><p>从事你所学的专业的可怕后果在于，它会让你忘记关注自己的事业。人们耗尽一生去关注别人的事业并使他人致富。<br>为了财务安全，人们需要关注自己的事业。</p>
<p>只有你把额外的收入用来购买可产生收入的资产，你才能获得真正的财务安全。</p>
<p>对于成年人而言，把支出保持在低水平，减少借款并勤劳工作会帮你打下一个稳固的资产基础。</p>
<p>真正的资产可分为：</p>
<ol>
<li>不需要自己到场就可以正常运作的业务。</li>
<li>股票</li>
<li>债券</li>
<li>共同基金</li>
<li>能产生收入的房地产</li>
<li>票据</li>
<li>版税，如：音乐、手稿、专利</li>
<li>其它任何有价值或有增值潜力的东西</li>
</ol>
<p>关注自己的事业，也就是要建立自己牢固的资产。</p>
<h2 id="税收的历史和公司的力量"><a href="#税收的历史和公司的力量" class="headerlink" title="税收的历史和公司的力量"></a>税收的历史和公司的力量</h2><p>政府对钱的胃口越来越大，且税收的范围正向穷人拓展。</p>
<p>资本家用财务知识逃脱了税收，并借助公司的保护来避税。</p>
<p>公司并不一定是一个真正是实体，公司可以是一些装着法律文件的文件夹，被放在办公室里。</p>
<p>“精于计算，你就不会被别人牵着走。”</p>
<p>“我把工资投资于资产项，再用资产项为我生产出来的钱购买我想要的东西。”</p>
<p>财商是由四个方面的专门知识构成的：</p>
<ol>
<li>会计，也就是财务知识。</li>
<li>投资，即钱生钱的科学。</li>
<li>了解市场，是供给于需求的科学。</li>
<li>法律。如：减税优惠，公司可以做许多个人无法完成的事情；在诉讼中获得保护。</li>
</ol>
<h2 id="富人的投资"><a href="#富人的投资" class="headerlink" title="富人的投资"></a>富人的投资</h2><blockquote>
<p>我们都拥有巨大的潜能。然而，我们都或多或少地存在着某种自我怀疑的心理，从而阻碍进步的步伐。这种障碍很少是缺乏某种技术性的东西，更多的是缺乏自信。</p>
</blockquote>
<p>陈旧的思想是人最大的债务。</p>
<p>提高自己的理财能力，就可以成为能够自己创造机遇的人，能够坦然地接受发生的任何事情，并努力使事情变得更好。</p>
<p>“金钱不是真正的资产。”</p>
<p>投资者分为两类：</p>
<ol>
<li>进行一揽子投资的人。</li>
<li>自己创造投资机会的投资者。</li>
</ol>
<p>要成为自己创造投资机会的投资者，还需要具备三种技能：</p>
<ol>
<li>寻找其他人都忽略的机会。</li>
<li>如何增加资金。</li>
<li>把精明的人组织起来。</li>
</ol>
<p>风险无处不在，要学会驾驭风险，而别总想着回避风险。</p>
<h2 id="学会不为钱而工作"><a href="#学会不为钱而工作" class="headerlink" title="学会不为钱而工作"></a>学会不为钱而工作</h2><p>大部分人需要学习和掌握不止一项技能，只有这样他们的收入才能获得显著增长。</p>
<p>不断学习才是一切。</p>
<p>从长远来看，教育比金钱更有价值。</p>
<p>许多才华横溢的人之所以贫穷，就是因为他们只是专心做好产品，而对商业体系知之甚少。</p>
<p>成功所需要的管理技能包括：</p>
<ol>
<li>对现金流的管理。</li>
<li>对系统的管理。</li>
<li>对人员的管理。</li>
</ol>
<p>销售技能是个人成功的基本技能，它涉及与其他人的交往，包括与顾客、雇员、老板、配偶和孩子。而沟通能力，如书面表达、口头表达以及谈判能力等对于一个人来说更是至关重要。</p>
<h2 id="客服困难"><a href="#客服困难" class="headerlink" title="客服困难"></a>客服困难</h2><p>人们在学会财务知识后，在通往财务自由的路上还面临着许多障碍：</p>
<ol>
<li>对可能亏钱的恐惧心理。</li>
<li>愤世嫉俗的心理。</li>
<li>懒惰。忙碌的人常常是最懒惰的。懒惰的一种最普遍的表现形式：通过忙碌来掩饰懒惰。<br>  “我可付不起”这句话禁锢了你的思想，使你无法进一步思考。“我怎样才能付得起”这句话开启了你的头脑，迫使你去思考并寻求答案。</li>
<li>习惯。</li>
<li>傲慢。傲慢是自大和无知的集合体。<br> 如果你知道自己在某一问题上有所欠缺，你就应该找一位本领域的专家或者一本相关的书，马上开始教育自己。</li>
</ol>
<h2 id="开始行动"><a href="#开始行动" class="headerlink" title="开始行动"></a>开始行动</h2><p>用10个步骤来开发自己的才能：</p>
<ol>
<li>找到自己的精神力量。</li>
<li>每天作出自己的选择－－－选择的力量。</li>
<li>慎重地选择朋友－－－关系的力量。</li>
<li>掌握一种模式，然后在学习一种新的模式－－－快速学习的力量。</li>
<li>首先支付自己－－－自信的力量。如果你控制不了自己，就别想着致富。<br> 能否自律是将富人、穷人和中产阶级区分开来的首要因素。</li>
<li>给你的经纪人以优厚的报酬－－－好建议的力量。</li>
<li>做一个无私的给予者－－－无私的力量。</li>
<li>用资产来购买奢侈品－－－专注的力量。</li>
<li>对英雄的崇拜－－－神话的力量。</li>
<li>先予后取－－－给予的力量。</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://chuanleiguo.com/2016/07/09/SwiftyJSON%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Chuanlei Guo">
      <meta itemprop="description" content="正因为未知，人与人之间的羁绊才愈发迷人">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chuan's Cabin">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2016/07/09/SwiftyJSON%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">SwiftyJSON 源码阅读笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2016-07-10 02:18:23" itemprop="dateCreated datePublished" datetime="2016-07-10T02:18:23+08:00">2016-07-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-03-03 11:30:13" itemprop="dateModified" datetime="2021-03-03T11:30:13+08:00">2021-03-03</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/sourcecode/" itemprop="url" rel="index"><span itemprop="name">源码分析</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2016/07/09/SwiftyJSON%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/07/09/SwiftyJSON源码阅读笔记/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>SwiftyJSON 是使用Swift编写的 JSON 解析库。Swift 是一门强类型的语言，并且引入了 Optional 类型。这使得解析 JSON 数据变得异常麻烦，我们往往需要不断地判断 Optional 中是否包含了有效值：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> jsonObject : <span class="type">AnyObject!</span> = <span class="type">NSJSONSerialization</span>.<span class="type">JSONObjectWithData</span>(dataFromTwitter, options: <span class="type">NSJSONReadingOptions</span>.<span class="type">MutableContainers</span>, error: <span class="literal">nil</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> statusesArray = jsonObject <span class="keyword">as</span>? <span class="type">NSArray</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> aStatus = statusesArray[<span class="number">0</span>] <span class="keyword">as</span>? <span class="type">NSDictionary</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> user = aStatus[<span class="string">"user"</span>] <span class="keyword">as</span>? <span class="type">NSDictionary</span>&#123;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> userName = user[<span class="string">"name"</span>] <span class="keyword">as</span>? <span class="type">NSDictionary</span>&#123;</span><br><span class="line">                </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用可选链的来访问 JSON 中的数据也依然非常麻烦。</p>
<p>SwiftyJSON 很好的解决了上面的问题，使我们可以用简洁的语法访问数据，而不用担心程序崩溃。正是因为安全、高效以及极易上手的特点，它在Github获得了超过10000 Star。</p>
<p>“优秀的源代码使最好的老师”。我们来研究一下 SwiftyJSON 是怎样实现的。</p>
<h2 id="数据保存"><a href="#数据保存" class="headerlink" title="数据保存"></a>数据保存</h2><p>SwiftJSON 使用一个 Struct 来抽象表示 JSON：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">JSON</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们在<a href="http://www.json.org" target="_blank" rel="noopener">json.org</a>看到，JSON 只可以存储几种简单的数据：</p>
<ol>
<li>键值对，即字典</li>
<li>数组，可以保存一系列的值</li>
<li>具体值，它可以是字符串，数字，json对象，数组，bool值，还可能是null</li>
</ol>
<p>SwiftyJSON 定义了一个枚举来抽象表示这些数据类型：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">Type</span> :<span class="title">Int</span></span>&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="type">Number</span>      </span><br><span class="line">    <span class="keyword">case</span> <span class="type">String</span></span><br><span class="line">    <span class="keyword">case</span> <span class="type">Bool</span></span><br><span class="line">    <span class="keyword">case</span> <span class="type">Array</span></span><br><span class="line">    <span class="keyword">case</span> <span class="type">Dictionary</span></span><br><span class="line">    <span class="keyword">case</span> <span class="type">Null</span></span><br><span class="line">    <span class="keyword">case</span> <span class="type">Unknown</span>     <span class="comment">// 代表未知类型，或无法解析</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SwiftyJSON 使用一个私有变量<code>_type</code>来确定数据的类型，并使用一系列私有的变量来保存相应类型的元数据(Raw Value)。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">var</span> _type: <span class="type">Type</span> = .<span class="type">Null</span>  <span class="comment">// 初始为空类型</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">var</span> rawArray: [<span class="type">AnyObject</span>] = []</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">var</span> rawDictionary: [<span class="type">String</span> : <span class="type">AnyObject</span>] = [:]</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">var</span> rawString: <span class="type">String</span> = <span class="string">""</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">var</span> rawNumber: <span class="type">NSNumber</span> = <span class="number">0</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">var</span> rawNull: <span class="type">NSNull</span> = <span class="type">NSNull</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用私有的 _error 来存储错误</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">var</span> _error: <span class="type">NSError?</span> = <span class="literal">nil</span></span><br></pre></td></tr></table></figure>

<p>现在，可以使用一个抽象的公有变量<code>object</code>作为接口，根据<em>Type</em>枚举来设置或取得JSON相应类型的数据：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> object: <span class="type">AnyObject</span> &#123;</span><br><span class="line">    <span class="keyword">get</span> &#123;</span><br><span class="line">        <span class="comment">// 根据 _type 来取得相应的数据 </span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">set</span> &#123;</span><br><span class="line">        <span class="comment">// 根据 _type 来设置相应的数据 </span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们以<code>object</code>的<code>set</code>方法为例来演示如何设置JSON的数据：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">var</span> object: <span class="type">AnyObject</span> &#123;</span><br><span class="line">    <span class="keyword">get</span> &#123;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">set</span> &#123;</span><br><span class="line">        _error = <span class="literal">nil</span></span><br><span class="line">        <span class="keyword">switch</span> newValue &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="keyword">let</span> number <span class="keyword">as</span> <span class="type">NSNumber</span>:</span><br><span class="line">                <span class="keyword">if</span> number.isBool &#123;</span><br><span class="line">                    _type = .<span class="type">Bool</span></span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    _type = .<span class="type">Number</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">self</span>.rawNumber = number</span><br><span class="line">            <span class="keyword">case</span>  <span class="keyword">let</span> string <span class="keyword">as</span> <span class="type">String</span>:</span><br><span class="line">                _type = .<span class="type">String</span></span><br><span class="line">                <span class="keyword">self</span>.rawString = string</span><br><span class="line">            <span class="keyword">case</span>  <span class="number">_</span> <span class="keyword">as</span> <span class="type">NSNull</span>:</span><br><span class="line">                _type = .<span class="type">Null</span></span><br><span class="line">            <span class="keyword">case</span> <span class="keyword">let</span> array <span class="keyword">as</span> [<span class="type">AnyObject</span>]:</span><br><span class="line">                _type = .<span class="type">Array</span></span><br><span class="line">                <span class="keyword">self</span>.rawArray = array</span><br><span class="line">            <span class="keyword">case</span> <span class="keyword">let</span> dictionary <span class="keyword">as</span> [<span class="type">String</span> : <span class="type">AnyObject</span>]:</span><br><span class="line">                _type = .<span class="type">Dictionary</span></span><br><span class="line">                <span class="keyword">self</span>.rawDictionary = dictionary</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                _type = .<span class="type">Unknown</span></span><br><span class="line">                _error = <span class="type">NSError</span>(domain: <span class="type">ErrorDomain</span>, code: <span class="type">ErrorUnsupportedType</span>, </span><br><span class="line">                userInfo: [<span class="type">NSLocalizedDescriptionKey</span>: <span class="string">"It is a unsupported type"</span>])</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>object</code>的<code>get</code>方法也是同样使用<em>switch/case</em>语句来根据<code>_type</code>得到相应的数据。</p>
<h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h3><p>SwiftyJSON 提供了丰富的初始化方法：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用 NSData 来创建 JSON </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">init</span>(data: <span class="type">NSData</span>, options opt: <span class="type">NSJSONReadingOptions</span>, error: <span class="type">NSErrorPointer</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用拥有字典、数组等数据类型属性的对象来创建 JSON </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">init</span>(<span class="number">_</span> object: <span class="type">AnyObject</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 [JSON] 来初始化 JSON</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">init</span>(<span class="number">_</span> jsonArray: [<span class="type">JSON</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 [String: JSON] 来初始化 JSON</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">init</span>(<span class="number">_</span> jsonDictionary: [<span class="type">String</span>: <span class="type">JSON</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 JSON 字符串来初始化 JSON</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">parse</span><span class="params">(string: String)</span></span> -&gt; <span class="type">JSON</span></span><br></pre></td></tr></table></figure>

<p>第一个初始化方法使用<code>NSJSONSerialization</code>创建包含相应属性的 JSON 对象：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">init</span>(data:<span class="type">NSData</span>, options opt: <span class="type">NSJSONReadingOptions</span> = .<span class="type">AllowFragments</span>, error: <span class="type">NSErrorPointer</span> = <span class="literal">nil</span>) &#123;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> object: <span class="type">AnyObject</span> = <span class="keyword">try</span> <span class="type">NSJSONSerialization</span>.<span class="type">JSONObjectWithData</span>(data, options: opt)</span><br><span class="line">        <span class="keyword">self</span>.<span class="keyword">init</span>(object)</span><br><span class="line">    &#125; <span class="keyword">catch</span> <span class="keyword">let</span> aError <span class="keyword">as</span> <span class="type">NSError</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> error != <span class="literal">nil</span> &#123;</span><br><span class="line">            error.memory = aError</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">self</span>.<span class="keyword">init</span>(<span class="type">NSNull</span>())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过调用这个初始化方法，可以将 JSON 字符串解析为 JSON 对象。如果字符串是合法的 JSON 字符串，那么就返回相应的 JSON 对象，负责返回一个空 JSON 对象：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">parse</span><span class="params">(string: String)</span></span> -&gt; <span class="type">JSON</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> string.dataUsingEncoding(<span class="type">NSUTF8StringEncoding</span>)</span><br><span class="line">        .flatMap(&#123;<span class="type">JSON</span>(data: $<span class="number">0</span>)&#125;) ?? <span class="type">JSON</span>(<span class="type">NSNull</span>())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>剩下的三个初始化方法均是直接设置 <code>struct JSON</code> 中的 <code>object</code> 对象来完成初始化：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">init</span>(<span class="number">_</span> object: <span class="type">AnyObject</span>) &#123;</span><br><span class="line">    <span class="keyword">self</span>.object = object</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">init</span>(<span class="number">_</span> jsonArray:[<span class="type">JSON</span>]) &#123;</span><br><span class="line">    <span class="keyword">self</span>.<span class="keyword">init</span>(jsonArray.<span class="built_in">map</span> &#123; $<span class="number">0</span>.object &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">init</span>(<span class="number">_</span> jsonDictionary:[<span class="type">String</span>: <span class="type">JSON</span>]) &#123;</span><br><span class="line">    <span class="keyword">var</span> dictionary = [<span class="type">String</span>: <span class="type">AnyObject</span>](minimumCapacity: jsonDictionary.<span class="built_in">count</span>)</span><br><span class="line">    <span class="keyword">for</span> (key, json) <span class="keyword">in</span> jsonDictionary &#123;</span><br><span class="line">        dictionary[key] = json.object</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">self</span>.<span class="keyword">init</span>(dictionary)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="用字面量初始化-JSON"><a href="#用字面量初始化-JSON" class="headerlink" title="用字面量初始化 JSON"></a>用字面量初始化 JSON</h4><p>SwiftyJSON 的另外一项功能就是可以使用字面量初始化 <code>struct JSON</code>：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// StringLiteralConvertible</span></span><br><span class="line"><span class="keyword">let</span> json: <span class="type">JSON</span> = <span class="string">"I'm a json"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// IntegerLiteralConvertible</span></span><br><span class="line"><span class="keyword">let</span> json: <span class="type">JSON</span> =  <span class="number">12345</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// FloatLiteralConvertible</span></span><br><span class="line"><span class="keyword">let</span> json: <span class="type">JSON</span> =  <span class="number">2.8765</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// With subscript in array</span></span><br><span class="line"><span class="keyword">var</span> json: <span class="type">JSON</span> =  [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// With subscript in dictionary</span></span><br><span class="line"><span class="keyword">var</span> json: <span class="type">JSON</span> =  [<span class="string">"name"</span>: <span class="string">"Jack"</span>, <span class="string">"age"</span>: <span class="number">25</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// Array &amp; Dictionary</span></span><br><span class="line"><span class="keyword">var</span> json: <span class="type">JSON</span> =  [<span class="string">"name"</span>: <span class="string">"Jack"</span>, <span class="string">"age"</span>: <span class="number">25</span>, <span class="string">"list"</span>: [<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>, [<span class="string">"what"</span>: <span class="string">"this"</span>]]]</span><br></pre></td></tr></table></figure>

<p>这个功能的实现很直接，就是根据<a href="http://nshipster.com/swift-literal-convertible/" target="_blank" rel="noopener">Swift Literal Convertibles</a>遵循一系列协议：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">JSON</span>: <span class="title">StringLiteralConvertible</span> </span>&#123; ... &#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">JSON</span>: <span class="title">IntegerLiteralConvertible</span> </span>&#123; ... &#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">JSON</span>: <span class="title">BooleanLiteralConvertible</span> </span>&#123; ... &#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">JSON</span>: <span class="title">FloatLiteralConvertible</span> </span>&#123; ... &#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">JSON</span>: <span class="title">DictionaryLiteralConvertible</span> </span>&#123; ... &#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">JSON</span>: <span class="title">ArrayLiteralConvertible</span> </span>&#123; ... &#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">JSON</span>: <span class="title">NilLiteralConvertible</span> </span>&#123; ... &#125;</span><br></pre></td></tr></table></figure>

<p>综上，SwiftyJSON 在初始化以后得到的是一个多个保存不同类型数据的 JSON 对象相互嵌套的模型：</p>
<p><img src="/images/2016-7-10/image.001.jpeg" alt="image.001"></p>
<h2 id="解析-JSON"><a href="#解析-JSON" class="headerlink" title="解析 JSON"></a>解析 JSON</h2><h3 id="下标"><a href="#下标" class="headerlink" title="下标"></a>下标</h3><p>在 SwiftyJSON 中的<code>struct JSON</code>保存的可能是字典，数组，或者是具体的值，如：字符串，数字。当保存的是字典或数组时，我们需要使用分别使用字符串和数字作为下标来访问其中的数据。为了可以同时使用字符串和数字作为下标，SwiftyJSON 定义了一个协议 <code>JSONSubscriptType</code> 来代表 <code>struct JSON</code> 的下标，并定义枚举类型 <code>JSONKey</code> 来区分字符串和数组。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">JSONKey</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="type">Index</span>(<span class="type">Int</span>)</span><br><span class="line">    <span class="keyword">case</span> <span class="type">Key</span>(<span class="type">String</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">protocol</span> <span class="title">JSONSubscriptType</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> jsonKey:<span class="type">JSONKey</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Int</span>: <span class="title">JSONSubscriptType</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> jsonKey:<span class="type">JSONKey</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">JSONKey</span>.<span class="type">Index</span>(<span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">String</span>: <span class="title">JSONSubscriptType</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> jsonKey:<span class="type">JSONKey</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">JSONKey</span>.<span class="type">Key</span>(<span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在使得字符串和整数均遵循 <code>JSONSubscriptType</code> 协议后，我们就可以同时使用这两种类型作为下标来访问数据了。SwiftyJSON 也在拓展中定义了两个下标方法，它们分别接受整数和字符串作为参数来访问数据：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">JSON</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">subscript</span>(index index: <span class="type">Int</span>) -&gt; <span class="type">JSON</span> &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">self</span>.type != .<span class="type">Array</span> &#123;</span><br><span class="line">                <span class="keyword">var</span> r = <span class="type">JSON</span>.null</span><br><span class="line">                r._error = <span class="keyword">self</span>._error ?? <span class="type">NSError</span>(domain: <span class="type">ErrorDomain</span>, code: <span class="type">ErrorWrongType</span>, userInfo: [<span class="type">NSLocalizedDescriptionKey</span>: <span class="string">"Array[\(index)] failure, It is not an array"</span>])</span><br><span class="line">                <span class="keyword">return</span> r</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> index &gt;= <span class="number">0</span> &amp;&amp; index &lt; <span class="keyword">self</span>.rawArray.<span class="built_in">count</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="type">JSON</span>(<span class="keyword">self</span>.rawArray[index])</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">var</span> r = <span class="type">JSON</span>.null</span><br><span class="line">                r._error = <span class="type">NSError</span>(domain: <span class="type">ErrorDomain</span>, code:<span class="type">ErrorIndexOutOfBounds</span> , userInfo: [<span class="type">NSLocalizedDescriptionKey</span>: <span class="string">"Array[\(index)] is out of bounds"</span>])</span><br><span class="line">                <span class="keyword">return</span> r</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">set</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">self</span>.type == .<span class="type">Array</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">self</span>.rawArray.<span class="built_in">count</span> &gt; index &amp;&amp; newValue.error == <span class="literal">nil</span> &#123;</span><br><span class="line">                    <span class="keyword">self</span>.rawArray[index] = newValue.object</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">subscript</span>(key key: <span class="type">String</span>) -&gt; <span class="type">JSON</span> &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="keyword">var</span> r = <span class="type">JSON</span>.null</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">self</span>.type == .<span class="type">Dictionary</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">let</span> o = <span class="keyword">self</span>.rawDictionary[key] &#123;</span><br><span class="line">                    r = <span class="type">JSON</span>(o)</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    r._error = <span class="type">NSError</span>(domain: <span class="type">ErrorDomain</span>, code: <span class="type">ErrorNotExist</span>, userInfo: [<span class="type">NSLocalizedDescriptionKey</span>: <span class="string">"Dictionary[\"\(key)\"] does not exist"</span>])</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                r._error = <span class="keyword">self</span>._error ?? <span class="type">NSError</span>(domain: <span class="type">ErrorDomain</span>, code: <span class="type">ErrorWrongType</span>, userInfo: [<span class="type">NSLocalizedDescriptionKey</span>: <span class="string">"Dictionary[\"\(key)\"] failure, It is not an dictionary"</span>])</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> r</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">set</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">self</span>.type == .<span class="type">Dictionary</span> &amp;&amp; newValue.error == <span class="literal">nil</span> &#123;</span><br><span class="line">                <span class="keyword">self</span>.rawDictionary[key] = newValue.object</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这两个私有方法分别使用整数和字符串作为参数来访问数据。在函数内部的访问逻辑中，它们分别判断了类型错误，整数下标是否越界，字符串下标是否存在等错误，完善得处理了在获得 JSON 数据过程中可能出现的错误。</p>
<p>SwiftyJSON 还定义了一个私有的下标方法来优雅地简化了对上述两个方法的调用：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">subscript</span>(sub sub: <span class="type">JSONSubscriptType</span>) -&gt; <span class="type">JSON</span> &#123;</span><br><span class="line">    <span class="keyword">get</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> sub.jsonKey &#123;</span><br><span class="line">        <span class="keyword">case</span> .<span class="type">Index</span>(<span class="keyword">let</span> index): <span class="keyword">return</span> <span class="keyword">self</span>[index: index]</span><br><span class="line">        <span class="keyword">case</span> .<span class="type">Key</span>(<span class="keyword">let</span> key): <span class="keyword">return</span> <span class="keyword">self</span>[key: key]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">set</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> sub.jsonKey &#123;</span><br><span class="line">        <span class="keyword">case</span> .<span class="type">Index</span>(<span class="keyword">let</span> index): <span class="keyword">self</span>[index: index] = newValue</span><br><span class="line">        <span class="keyword">case</span> .<span class="type">Key</span>(<span class="keyword">let</span> key): <span class="keyword">self</span>[key: key] = newValue</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个私有的下标方法给提供的一个简单的内部接口，它判断下标的类型，从而在内部调用的时候可以不用关心下标的具体类型。</p>
<p>在以上三个私有方法的基础上，SwiftyJSON 定义了两个接口，使得我们可以用非常简单的语法来安全地访问数据：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">subscript</span>(path: [<span class="type">JSONSubscriptType</span>]) -&gt; <span class="type">JSON</span> &#123;</span><br><span class="line">    <span class="keyword">get</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> path.<span class="built_in">reduce</span>(<span class="keyword">self</span>) &#123; $<span class="number">0</span>[sub: $<span class="number">1</span>] &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">set</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> path.<span class="built_in">count</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">self</span>[sub:path[<span class="number">0</span>]].object = newValue.object</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">var</span> aPath = path; aPath.removeAtIndex(<span class="number">0</span>)</span><br><span class="line">            <span class="keyword">var</span> nextJSON = <span class="keyword">self</span>[sub: path[<span class="number">0</span>]]</span><br><span class="line">            nextJSON[aPath] = newValue</span><br><span class="line">            <span class="keyword">self</span>[sub: path[<span class="number">0</span>]] = nextJSON</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">subscript</span>(path: <span class="type">JSONSubscriptType</span>...) -&gt; <span class="type">JSON</span> &#123;</span><br><span class="line">    <span class="keyword">get</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>[path]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">set</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>[path] = newValue</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这两个函数巧妙得使用了函数式编程的技巧，如<code>path.reduce(self) { $0[sub: $1] }</code>，使代码简洁易读，这也正是使用 Swift 写出的代码应该具备的特点：安全、简洁、高效。</p>
<p>使用这两个方法，我们可以这样得到 JSON 对象中的数据：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> name = json[<span class="number">9</span>][<span class="string">"list"</span>][<span class="string">"person"</span>][<span class="string">"name"</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> sameName = json[<span class="number">9</span>,<span class="string">"list"</span>,<span class="string">"person"</span>,<span class="string">"name"</span>]</span><br></pre></td></tr></table></figure>

<p>这比起文章开头的例子，是不是简单、易读了太多呢？</p>
<h3 id="安全地访问数据"><a href="#安全地访问数据" class="headerlink" title="安全地访问数据"></a>安全地访问数据</h3><p>SwiftyJSON 使用两种不同命名的只读计算变量来使我们可以根据自己的需要安全得访问数据。只读计算变量的命名遵循以下规则：</p>
<ol>
<li><code>type</code> —— 返回包含该类型的可选值，当数据错误时返回nil</li>
<li><code>typeValue</code> —— 返回具体的值，当数据错误时返回具体类型的默认值，如[], 0等。</li>
</ol>
<p>所以要得到 JSON 数组或字典，我们可以使用以下接口：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MARK: - Array</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">JSON</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> array: [<span class="type">JSON</span>]? &#123; <span class="keyword">get</span> &#125;     <span class="comment">// 返回 Optional([JSON])</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> arrayValue: [<span class="type">JSON</span>] &#123; <span class="keyword">get</span> &#125; <span class="comment">// 返回 [JSON]</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: - Dictionary</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">JSON</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> dictionary: [<span class="type">String</span>: <span class="type">JSON</span>]? &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> dictionaryValue: [<span class="type">String</span>: <span class="type">JSON</span>] &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>要得到数组和字典中的元素，SwiftyJSON 也定义了相应的接口，它们均是计算属性，通过访问内部的数据结构来获取或设置数据：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MARK: - Array</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">JSON</span> </span>&#123;</span><br><span class="line">    <span class="comment">//Optional [AnyObject]</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> arrayObject: [<span class="type">AnyObject</span>]? &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="keyword">switch</span> <span class="keyword">self</span>.type &#123;</span><br><span class="line">            <span class="keyword">case</span> .<span class="type">Array</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">self</span>.rawArray</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">set</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> array = newValue &#123;</span><br><span class="line">                <span class="keyword">self</span>.object = array</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">self</span>.object = <span class="type">NSNull</span>()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: - Dictionary</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">JSON</span> </span>&#123;</span><br><span class="line">    <span class="comment">//Optional [String : AnyObject]</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> dictionaryObject: [<span class="type">String</span> : <span class="type">AnyObject</span>]? &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="keyword">switch</span> <span class="keyword">self</span>.type &#123;</span><br><span class="line">            <span class="keyword">case</span> .<span class="type">Dictionary</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">self</span>.rawDictionary</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">set</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> v = newValue &#123;</span><br><span class="line">                <span class="keyword">self</span>.object = v</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">self</span>.object = <span class="type">NSNull</span>()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SwiftyJSON 中 <code>struct JSON</code> 内部使用<em>NSNumber</em>类型的<code>rawNumber</code>来保存bool和数字，所以SwiftyJSON 定义了返回<em>NSNumber</em>的接口，也可以通过这个接口来得到相应类型的数字，如：Int, Double, Float, Int8, Int16, Int32, Int64等。</p>
<p>特别注意一点，因为 JSON 本质上是一个文本文件，它的内容均是字符串。所以在我们要获得数字的时候，要将用字符串表示的数字，如“123”，转化为<em>NSNumber</em>。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MARK: - Number</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">JSON</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Optional number</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> number: <span class="type">NSNumber?</span> &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="keyword">switch</span> <span class="keyword">self</span>.type &#123;</span><br><span class="line">            <span class="keyword">case</span> .<span class="type">Number</span>, .<span class="type">Bool</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">self</span>.rawNumber</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">set</span> &#123;</span><br><span class="line">            <span class="keyword">self</span>.object = newValue ?? <span class="type">NSNull</span>()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Non-optional number</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> numberValue: <span class="type">NSNumber</span> &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="keyword">switch</span> <span class="keyword">self</span>.type &#123;</span><br><span class="line">            <span class="keyword">case</span> .<span class="type">String</span>:</span><br><span class="line">                <span class="keyword">let</span> decimal = <span class="type">NSDecimalNumber</span>(string: <span class="keyword">self</span>.object <span class="keyword">as</span>? <span class="type">String</span>)</span><br><span class="line">                <span class="keyword">if</span> decimal == <span class="type">NSDecimalNumber</span>.notANumber() &#123;  <span class="comment">// indicates parse error</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="type">NSDecimalNumber</span>.zero()</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> decimal</span><br><span class="line">            <span class="keyword">case</span> .<span class="type">Number</span>, .<span class="type">Bool</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">self</span>.object <span class="keyword">as</span>? <span class="type">NSNumber</span> ?? <span class="type">NSNumber</span>(int: <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="type">NSNumber</span>(double: <span class="number">0.0</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">set</span> &#123;</span><br><span class="line">            <span class="keyword">self</span>.object = newValue</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>之后，SwiftJSON 使用<code>public var number</code>和<code>public var numberValue</code>这两个接口在得到各种数字类型，以<em>Double</em>为例：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">JSON</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> double: <span class="type">Double?</span> &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">self</span>.number?.double</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">set</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> newValue = newValue &#123;</span><br><span class="line">                <span class="keyword">self</span>.object = <span class="type">NSNumber</span>(double: newValue)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">self</span>.object = <span class="type">NSNull</span>()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> doubleValue: <span class="type">Double</span> &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">self</span>.numberValue.doubleValue</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">set</span> &#123;</span><br><span class="line">            <span class="keyword">self</span>.object = <span class="type">NSNumber</span>(double: newValue)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>获得其它类型数字的接口的实现方法和这段代码类似。</p>
<p>此外，SwiftyJSON 也定义了我们非常常用的返回URL的接口，它返回一个Optional：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MARK: - URL</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">JSON</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> <span class="type">URL</span>: <span class="type">NSURL?</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用-Raw-Value"><a href="#使用-Raw-Value" class="headerlink" title="使用 Raw Value"></a>使用 Raw Value</h3><p>除了使用解析后的具体的值以外，SwiftyJSON 通过遵循<em>RawRepresentable</em>协议，来允许我们直接使用元数据(Raw Value)。我们可以选择直接使用 JSON 对象：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">JSON</span>: <span class="title">RawRepresentable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>?(rawValue: <span class="type">AnyObject</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="type">JSON</span>(rawValue).type == .<span class="type">Unknown</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">self</span>.<span class="keyword">init</span>(rawValue)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> rawValue: <span class="type">AnyObject</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.object</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以直接将 JSON 对象转化为NSData:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">JSON</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">rawData</span><span class="params">(options opt: NSJSONWritingOptions = NSJSONWritingOptions<span class="params">(rawValue: <span class="number">0</span>)</span></span></span>) <span class="keyword">throws</span> -&gt; <span class="type">NSData</span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="type">NSJSONSerialization</span>.isValidJSONObject(<span class="keyword">self</span>.object) <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="type">NSError</span>(domain: <span class="type">ErrorDomain</span>, code: <span class="type">ErrorInvalidJSON</span>, userInfo: [<span class="type">NSLocalizedDescriptionKey</span>: <span class="string">"JSON is invalid"</span>])</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">try</span> <span class="type">NSJSONSerialization</span>.dataWithJSONObject(<span class="keyword">self</span>.object, options: opt)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 我们可以简单地将 JSON 对象转化为 NSData</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> data = json.rawData() &#123;</span><br><span class="line">    <span class="comment">//Do something you want</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>也可以把 JSON 对象转化为字符串：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">JSON</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">rawString</span><span class="params">(encoding: UInt = NSUTF8StringEncoding, options opt: NSJSONWritingOptions = .PrettyPrinted)</span></span> -&gt; <span class="type">String?</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> <span class="keyword">self</span>.type &#123;</span><br><span class="line">        <span class="keyword">case</span> .<span class="type">Array</span>, .<span class="type">Dictionary</span>:</span><br><span class="line">            <span class="keyword">do</span> &#123;</span><br><span class="line">                <span class="keyword">let</span> data = <span class="keyword">try</span> <span class="keyword">self</span>.rawData(options: opt)</span><br><span class="line">                <span class="keyword">return</span> <span class="type">NSString</span>(data: data, encoding: encoding) <span class="keyword">as</span>? <span class="type">String</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> <span class="number">_</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">case</span> .<span class="type">String</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">self</span>.rawString</span><br><span class="line">        <span class="keyword">case</span> .<span class="type">Number</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">self</span>.rawNumber.stringValue</span><br><span class="line">        <span class="keyword">case</span> .<span class="type">Bool</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">self</span>.rawNumber.boolValue.description</span><br><span class="line">        <span class="keyword">case</span> .<span class="type">Null</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"null"</span></span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 我们可以简单地将 JSON 对象转化为 String</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> string = json.rawString() &#123;</span><br><span class="line">    <span class="comment">//Do something you want</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SwiftyJSON 也让 <code>struct JSON</code> 遵循了<em>Printable</em>和<em>DebugPrintable</em>协议，使我们可以直接以字符串的形式输出JSON:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">JSON</span>: <span class="title">Printable</span>, <span class="title">DebugPrintable</span> </span>&#123; ... &#125;</span><br></pre></td></tr></table></figure>

<h2 id="遍历-JSON"><a href="#遍历-JSON" class="headerlink" title="遍历 JSON"></a>遍历 JSON</h2><p>在 SwiftyJSON 的<a href="https://github.com/SwiftyJSON/SwiftyJSON/blob/master/README.md" target="_blank" rel="noopener">介绍</a>中，描写了对 JSON 的遍历功能：</p>
<blockquote>
<p>如果 JSON 是 Dictionary</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (key: subJson): (<span class="type">String</span>: <span class="type">JSON</span>) <span class="keyword">in</span> <span class="type">JSON</span> &#123;</span><br><span class="line">    <span class="comment">// 其中 key 就是字典中的键</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果 JSON 是 Array</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (index, json): (<span class="type">String</span>: <span class="type">JSON</span>) <span class="keyword">in</span> <span class="type">JSON</span> &#123;</span><br><span class="line">    <span class="comment">// 其中 key 就是字符串类型的 o..&lt;json.count 的值</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</blockquote>
<p>要使得 <code>struct JSON</code> 可以在<em>for…in</em>循环中被多次遍历，就需要让 <code>struct JSON</code> 遵从<em>CollectionType</em>协议。 </p>
<h3 id="遵循-CollectionType-协议"><a href="#遵循-CollectionType-协议" class="headerlink" title="遵循 CollectionType 协议"></a>遵循 CollectionType 协议</h3><p>首先，SwiftyJSON 定义了遵循<em>CollectionType</em>协议所需要的两个关联类型，它们分别代表了集合中的元素的生成器、访问集合元素时所要使用的下标类型，以及遍历时生成下一个元素的生成器:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">JSON</span>: <span class="title">CollectionType</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">typealias</span> <span class="type">Generator</span> = <span class="type">JSONGenerator</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">typealias</span> <span class="type">Index</span> = <span class="type">JSONIndex</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">generate</span><span class="params">()</span></span> -&gt; <span class="type">JSON</span>.<span class="type">Generator</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">JSON</span>.<span class="type">Generator</span>(<span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>之后，实现了返回起始和结尾索引、根据索引返回相应元素的接口，并根据需要重写了默认的方法。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">JSON</span>: <span class="title">CollectionType</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> startIndex: <span class="type">JSON</span>.<span class="type">Index</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> <span class="keyword">self</span>.type &#123;</span><br><span class="line">        <span class="keyword">case</span> .<span class="type">Array</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="type">JSONIndex</span>(arrayIndex: <span class="keyword">self</span>.rawArray.startIndex)</span><br><span class="line">        <span class="keyword">case</span> .<span class="type">Dictionary</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="type">JSONIndex</span>(dictionaryIndex: <span class="keyword">self</span>.rawDictionary.startIndex)</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="type">JSONIndex</span>()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> endIndex: <span class="type">JSON</span>.<span class="type">Index</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> <span class="keyword">self</span>.type &#123;</span><br><span class="line">        <span class="keyword">case</span> .<span class="type">Array</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="type">JSONIndex</span>(arrayIndex: <span class="keyword">self</span>.rawArray.endIndex)</span><br><span class="line">        <span class="keyword">case</span> .<span class="type">Dictionary</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="type">JSONIndex</span>(dictionaryIndex: <span class="keyword">self</span>.rawDictionary.endIndex)</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="type">JSONIndex</span>()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">subscript</span> (position: <span class="type">JSON</span>.<span class="type">Index</span>) -&gt; <span class="type">JSON</span>.<span class="type">Generator</span>.<span class="type">Element</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> <span class="keyword">self</span>.type &#123;</span><br><span class="line">        <span class="keyword">case</span> .<span class="type">Array</span>:</span><br><span class="line">            <span class="keyword">return</span> (<span class="type">String</span>(position.arrayIndex), <span class="type">JSON</span>(<span class="keyword">self</span>.rawArray[position.arrayIndex!]))</span><br><span class="line">        <span class="keyword">case</span> .<span class="type">Dictionary</span>:</span><br><span class="line">            <span class="keyword">let</span> (key, value) = <span class="keyword">self</span>.rawDictionary[position.dictionaryIndex!]</span><br><span class="line">            <span class="keyword">return</span> (key, <span class="type">JSON</span>(value))</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> (<span class="string">""</span>, <span class="type">JSON</span>.null)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> isEmpty: <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123;</span><br><span class="line">            <span class="keyword">switch</span> <span class="keyword">self</span>.type &#123;</span><br><span class="line">            <span class="keyword">case</span> .<span class="type">Array</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">self</span>.rawArray.isEmpty</span><br><span class="line">            <span class="keyword">case</span> .<span class="type">Dictionary</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">self</span>.rawDictionary.isEmpty</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> <span class="built_in">count</span>: <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> <span class="keyword">self</span>.type &#123;</span><br><span class="line">        <span class="keyword">case</span> .<span class="type">Array</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">self</span>.rawArray.<span class="built_in">count</span></span><br><span class="line">        <span class="keyword">case</span> .<span class="type">Dictionary</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">self</span>.rawDictionary.<span class="built_in">count</span></span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">underestimateCount</span><span class="params">()</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> <span class="keyword">self</span>.type &#123;</span><br><span class="line">        <span class="keyword">case</span> .<span class="type">Array</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">self</span>.rawArray.<span class="built_in">underestimateCount</span>()</span><br><span class="line">        <span class="keyword">case</span> .<span class="type">Dictionary</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">self</span>.rawDictionary.<span class="built_in">underestimateCount</span>()</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当 JSON 中保存的对象是数组或字典是，要分别使用整数和字符串作为索引来访问相应的值。所以在接口的实现中，根据索引的类型来访问相应的数据结构。</p>
<blockquote>
<p>因为 Swift 是一门多范式的“面向协议”的编程语言。在 Protocol Extension 的帮助下，我们不需要实现协议的所有方法。仅仅需要覆盖少数方法即可。其它的方法可以直接使用默认实现。</p>
</blockquote>
<h4 id="实现-JSONGenerator"><a href="#实现-JSONGenerator" class="headerlink" title="实现 JSONGenerator"></a>实现 JSONGenerator</h4><p>在使 <code>struct JSON</code> 遵循<em>CollectionType*的时候，需要使用一个元素生成器。SwiftyJSON 定义了一个 *JSONGenerator</em> 类型的生成器。它的元素类型为<code>(String, JSON)</code>，即一个tuple。这个tuple的第一个值用字符串表示元素在集合中的索引；第二个值则是<code>struct JSON</code>，这也使我们可以在遍历过程中方便地访问数据。</p>
<p>因为在 JSON 中可以遍历数组或字典，所以<em>JSONGenerator<em>中使用了标准库中的</em>IndexingGenerator</em>, <em>DictionaryGenerator</em>两个生成器来分别生成数组或字典元素，并使用一个私有变量<code>type</code>来对生成的元素的类型加以区分。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">JSONGenerator</span>: <span class="title">GeneratorType</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 生成元素的类型为(String, JSON)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">typealias</span> <span class="type">Element</span> = (<span class="type">String</span>, <span class="type">JSON</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">let</span> type: <span class="type">Type</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> dictionayGenerate: <span class="type">DictionaryGenerator</span>&lt;<span class="type">String</span>, <span class="type">AnyObject</span>&gt;?</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> arrayGenerate: <span class="type">IndexingGenerator</span>&lt;[<span class="type">AnyObject</span>]&gt;?</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> arrayIndex: <span class="type">Int</span> = <span class="number">0</span>      <span class="comment">// 当生成器生成数组元素时，保存数组索引</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span>(<span class="number">_</span> json: <span class="type">JSON</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.type = json.type</span><br><span class="line">        <span class="keyword">if</span> type == .<span class="type">Array</span> &#123;</span><br><span class="line">            <span class="keyword">self</span>.arrayGenerate = json.rawArray.generate()</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">self</span>.dictionayGenerate = json.rawDictionary.generate()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>要实现一个生成器非常简单，仅仅需要实现一个<em>next</em>方法即可：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">next</span><span class="params">()</span></span> -&gt; <span class="type">JSONGenerator</span>.<span class="type">Element?</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> <span class="keyword">self</span>.type &#123;</span><br><span class="line">    <span class="keyword">case</span> .<span class="type">Array</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> o = <span class="keyword">self</span>.arrayGenerate?.next() &#123;</span><br><span class="line">            <span class="keyword">let</span> i = <span class="keyword">self</span>.arrayIndex</span><br><span class="line">            <span class="keyword">self</span>.arrayIndex += <span class="number">1</span></span><br><span class="line">            <span class="keyword">return</span> (<span class="type">String</span>(i), <span class="type">JSON</span>(o))</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">case</span> .<span class="type">Dictionary</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> (k, v): (<span class="type">String</span>, <span class="type">AnyObject</span>) = <span class="keyword">self</span>.dictionayGenerate?.next() &#123;</span><br><span class="line">            <span class="keyword">return</span> (k, <span class="type">JSON</span>(v))</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个方法会根据<code>type</code>来分别调用相应的生成器来生成数组或字典元素。</p>
<h4 id="实现-JSONIndex"><a href="#实现-JSONIndex" class="headerlink" title="实现 JSONIndex"></a>实现 JSONIndex</h4><p>在遍历 <code>struct JSON</code> 的过程中，我们需要使用索引来访问相应的元素。因为我们所遍历的可能时数组或字典，所以在<em>JSONIndex</em>中，分别声明了两个变量<code>arrayIndex</code>和<code>dictionaryIndex</code>来作为索引，并使用一个私有变量 <code>type</code> 来区分：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">JSONIndex</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> arrayIndex: <span class="type">Int?</span></span><br><span class="line">    <span class="keyword">let</span> dictionaryIndex: <span class="type">DictionaryIndex</span>&lt;<span class="type">String</span>, <span class="type">AnyObject</span>&gt;?</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> type: <span class="type">Type</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>()&#123;</span><br><span class="line">        <span class="keyword">self</span>.arrayIndex = <span class="literal">nil</span></span><br><span class="line">        <span class="keyword">self</span>.dictionaryIndex = <span class="literal">nil</span></span><br><span class="line">        <span class="keyword">self</span>.type = .<span class="type">Unknown</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(arrayIndex: <span class="type">Int</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.arrayIndex = arrayIndex</span><br><span class="line">        <span class="keyword">self</span>.dictionaryIndex = <span class="literal">nil</span></span><br><span class="line">        <span class="keyword">self</span>.type = .<span class="type">Array</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(dictionaryIndex: <span class="type">DictionaryIndex</span>&lt;<span class="type">String</span>, <span class="type">AnyObject</span>&gt;) &#123;</span><br><span class="line">        <span class="keyword">self</span>.arrayIndex = <span class="literal">nil</span></span><br><span class="line">        <span class="keyword">self</span>.dictionaryIndex = dictionaryIndex</span><br><span class="line">        <span class="keyword">self</span>.type = .<span class="type">Dictionary</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>要使得<em>JSONIndex</em>可以在集合中作为索引使用，它必须遵循<em>ForwardIndexType</em>协议，并实现协议中的<code>successor</code>方法：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">JSONIndex</span>: <span class="title">ForwardIndexType</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">successor</span><span class="params">()</span></span> -&gt; <span class="type">JSONIndex</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> <span class="keyword">self</span>.type &#123;</span><br><span class="line">        <span class="keyword">case</span> .<span class="type">Array</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="type">JSONIndex</span>(arrayIndex: <span class="keyword">self</span>.arrayIndex!.successor())</span><br><span class="line">        <span class="keyword">case</span> .<span class="type">Dictionary</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="type">JSONIndex</span>(dictionaryIndex: <span class="keyword">self</span>.dictionaryIndex!.successor())</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="type">JSONIndex</span>()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这个实现中，根据遍历数据结构类型的不同，而返回不同类型的索引。</p>
<p>我们需要知道两个<em>JSONIndex</em>是否相等，或得到两个索引的大小关系，所以<em>JSONIndex</em>遵循了<em>Equatable</em>和<em>Comparable</em>协议：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">JSONIndex</span>: <span class="title">Equatable</span>, <span class="title">Comparable</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> ==<span class="params">(lhs: JSONIndex, rhs: JSONIndex)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> (lhs.type, rhs.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> (.<span class="type">Array</span>, .<span class="type">Array</span>):</span><br><span class="line">        <span class="keyword">return</span> lhs.arrayIndex == rhs.arrayIndex</span><br><span class="line">    <span class="keyword">case</span> (.<span class="type">Dictionary</span>, .<span class="type">Dictionary</span>):</span><br><span class="line">        <span class="keyword">return</span> lhs.dictionaryIndex == rhs.dictionaryIndex</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> &lt;(lhs: JSONIndex, rhs: JSONIndex) -&gt; <span class="title">Bool</span> </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (lhs.type, rhs.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> (.<span class="type">Array</span>, .<span class="type">Array</span>):</span><br><span class="line">        <span class="keyword">return</span> lhs.arrayIndex &lt; rhs.arrayIndex</span><br><span class="line">    <span class="keyword">case</span> (.<span class="type">Dictionary</span>, .<span class="type">Dictionary</span>):</span><br><span class="line">        <span class="keyword">return</span> lhs.dictionaryIndex &lt; rhs.dictionaryIndex</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> &lt;=(lhs: JSONIndex, rhs: JSONIndex) -&gt; <span class="title">Bool</span> </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (lhs.type, rhs.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> (.<span class="type">Array</span>, .<span class="type">Array</span>):</span><br><span class="line">        <span class="keyword">return</span> lhs.arrayIndex &lt;= rhs.arrayIndex</span><br><span class="line">    <span class="keyword">case</span> (.<span class="type">Dictionary</span>, .<span class="type">Dictionary</span>):</span><br><span class="line">        <span class="keyword">return</span> lhs.dictionaryIndex &lt;= rhs.dictionaryIndex</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> &gt;=<span class="params">(lhs: JSONIndex, rhs: JSONIndex)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> (lhs.type, rhs.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> (.<span class="type">Array</span>, .<span class="type">Array</span>):</span><br><span class="line">        <span class="keyword">return</span> lhs.arrayIndex &gt;= rhs.arrayIndex</span><br><span class="line">    <span class="keyword">case</span> (.<span class="type">Dictionary</span>, .<span class="type">Dictionary</span>):</span><br><span class="line">        <span class="keyword">return</span> lhs.dictionaryIndex &gt;= rhs.dictionaryIndex</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> &gt;<span class="params">(lhs: JSONIndex, rhs: JSONIndex)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> (lhs.type, rhs.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> (.<span class="type">Array</span>, .<span class="type">Array</span>):</span><br><span class="line">        <span class="keyword">return</span> lhs.arrayIndex &gt; rhs.arrayIndex</span><br><span class="line">    <span class="keyword">case</span> (.<span class="type">Dictionary</span>, .<span class="type">Dictionary</span>):</span><br><span class="line">        <span class="keyword">return</span> lhs.dictionaryIndex &gt; rhs.dictionaryIndex</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="源码学习体会"><a href="#源码学习体会" class="headerlink" title="源码学习体会"></a>源码学习体会</h2><p>我从2014年6月，Apple在WWDC上公布Swift起就开始关注这门现代的编程语言，关注它的每一个变化，尝试用Swift来解决问题，开发App，并享受编程了乐趣。</p>
<p>可惜由于编程能力欠佳，我对这门语言的理解依然有限，使用Swift编写出的代码仍然浓浓的Objective-C的味道。可以说自己是在使用Swift的语法来编写Objective-C。</p>
<p>通过对 SwiftyJSON 这样的优秀的开源代码的学习，我学到了很多。</p>
<ol>
<li>我学会了要在在恰当地使用函数式编程，这样写出的代码简洁、高效并且有良好的可读性，SwiftyJSON 中实现<em>DictionaryLiteralConvertible</em>、实现<code>let name = json[9][&quot;list&quot;][&quot;person&quot;][&quot;name&quot;]</code>访问数据等都是出色的实践。</li>
<li>对SwiftyJSON 代码的分析也加深了我对 Swift “面向协议编程”、“从协议出发编程”，值语义等概念的理解；</li>
</ol>
<p>在今后的实践中，我也要有意识得运用这些编程技巧，写出更加Swifty的代码，更合理、高效地解决编程中遇到的问题。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Chuanlei Guo</p>
  <div class="site-description" itemprop="description">正因为未知，人与人之间的羁绊才愈发迷人</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">25</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">26</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/ChuanleiGuo" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;ChuanleiGuo" rel="noopener" target="_blank"><i class="github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:chuanleiguo@gmail.com" title="E-Mail → mailto:chuanleiguo@gmail.com" rel="noopener" target="_blank"><i class="envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="http://weibo.com/bestchuan" title="Weibo → http:&#x2F;&#x2F;weibo.com&#x2F;bestchuan" rel="noopener" target="_blank"><i class="weibo fa-fw"></i>Weibo</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2016 – 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Chuanlei Guo</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://chuanleiguo-com.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>

</body>
</html>
